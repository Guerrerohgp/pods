var PodsUI=function(){"use strict";var e={};e["typeof"]="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol?"symbol":typeof e};var i=Backbone.Model.extend({defaults:{id:0,icon:"",name:"",link:""}}),t=Backbone.Collection.extend({model:i,field_meta:{},initialize:function(e,i){this.field_meta=i||{},this.field_meta.field_options=this.field_meta.field_options||{},this.listenTo(this,"add",this.onCollectionAdd)},onCollectionAdd:function(e,i,t){this.truncateToFileLimit(this.field_meta.field_options.file_limit)},truncateToFileLimit:function(e){var i;0!=e&&this.length>e&&(i=this.at(0),i.trigger("destroy",i))}}),o=jQuery,l=Mn.LayoutView.extend({tagName:"li",className:"pods-file",ui:{drag_handle:".pods-file-handle",download_link:".pods-file-download",remove_button:".pods-file-remove"},template:_.template(o("#file-upload-item-template").html()),triggers:{"click @ui.remove_button":"remove:file:click"},serializeData:function(){var e=this.model.toJSON();return e.attr=this.options.field_attributes,e.options=this.options.field_options,e}}),n=Mn.CollectionView.extend({tagName:"ul",className:"pods-files pods-files-list",childView:l,initialize:function(e){this.childViewOptions=e.field_meta},onAttach:function(){1!=this.options.field_meta.field_options.file_limit&&this.$el.sortable({containment:"parent",axis:"y",scrollSensitivity:40,tolerance:"pointer",opacity:.6})}}),s=jQuery,d=Mn.LayoutView.extend({tagName:"div",ui:{add_button:".pods-file-add"},template:_.template(s("#file-upload-form-template").html()),triggers:{"click @ui.add_button":"add:file:click"},serializeData:function(){var e={};return e.attributes=this.options.field_meta.field_attributes,e.options=this.options.field_meta.field_options,e}}),a=Mn.Object.extend({constructor:function(e){this.browse_button=e.browse_button,this.ui_region=e.ui_region,this.field_options=e.field_options,Mn.Object.call(this,e)}}),r=jQuery,u=Backbone.Model.extend({defaults:{id:0,filename:"",progress:0,error_msg:""}}),f=Mn.LayoutView.extend({model:u,tagName:"li",template:_.template(r("#file-upload-queue-template").html()),attributes:function(){return{"class":"pods-file",id:this.model.get("id")}},modelEvents:{change:"onModelChanged"},onModelChanged:function(){this.render()}}),p=Mn.CollectionView.extend({tagName:"ul",className:"pods-files pods-files-queue",childView:f}),c=Object.freeze({FileUploadQueueModel:u,FileUploadQueueItem:f,FileUploadQueue:p}),h=jQuery,m=a.extend({plupload:{},initialize:function(){this.field_options.plupload_init.browse_button=this.browse_button,this.plupload=new plupload.Uploader(this.field_options.plupload_init),this.plupload.init(),this.plupload.bind("FilesAdded",this.onFilesAdded,this),this.plupload.bind("UploadProgress",this.onUploadProgress,this),this.plupload.bind("FileUploaded",this.onFileUploaded,this)},onFilesAdded:function(e,i){var t,o,l;o=new Backbone.Collection,h.each(i,function(e,i){t=new u({id:i.id,filename:i.name}),o.add(t)}),l=new p({collection:o}),l.render(),this.ui_region.reset(),this.ui_region.show(l),this.queue_collection=o,e.refresh(),e.start()},onUploadProgress:function(e,i){var t=this.queue_collection.get(i.id);t.set({progress:i.percent})},onFileUploaded:function(i,t,o){var l=o.response,n=[],s=this.queue_collection.get(t.id);if("Error: "==o.response.substr(0,7))l=l.substr(7),window.console&&console.log(l),s.set({progress:0,error_msg:l});else if("<e>"==o.response.substr(0,3))l=h(l).text(),window.console&&console.log(l),s.set({progress:0,error_msg:l});else{var d=l.match(/{.*}$/);if(d=null!==d&&0<d.length?h.parseJSON(d[0]):{},"object"!=("undefined"==typeof d?"undefined":e["typeof"](d))||h.isEmptyObject(d))return window.console&&console.log(l),window.console&&console.log(d),void s.set({progress:0,error_msg:"There was an issue with the file upload, please try again."});n={id:d.ID,icon:d.thumbnail,name:d.post_title,link:d.link},s.trigger("destroy",s),this.trigger("added:files",n)}},invoke:function(){}}),b=a.extend({media_object:{},invoke:function(){void 0===wp.Uploader.defaults.filters.mime_types&&(wp.Uploader.defaults.filters.mime_types=[{title:"Allowed Files",extensions:"*"}]);var e=wp.Uploader.defaults.filters.mime_types[0].extensions;wp.Uploader.defaults.filters.mime_types[0].extensions=this.field_options.limit_extensions,this.media_object=wp.media({title:this.field_options.file_modal_title,multiple:1!=this.field_options.file_limit,library:{type:this.field_options.limit_types},button:{text:this.field_options.file_modal_add_button}}),this.media_object.once("select",this.onMediaSelect,this),this.media_object.open(),this.media_object.content.mode(this.field_options.file_attachment_tab),wp.Uploader.defaults.filters.mime_types[0].extensions=e},onMediaSelect:function(){var e=[],i=this.media_object.state().get("selection");i&&(i.each(function(i){var t,o=i.attributes.sizes;t=i.attributes.icon,void 0!==o&&(void 0!==o.thumbnail&&void 0!==o.thumbnail.url?t=o.thumbnail.url:void 0!==o.full&&void 0!==o.full.url&&(t=o.full.url)),e.push({id:i.attributes.id,icon:t,name:i.attributes.title,link:i.attributes.url})}),this.trigger("added:files",e))}}),g=jQuery,w="plupload",v=Mn.LayoutView.extend({template:_.template(g("#file-upload-layout-template").html()),regions:{list:".pods-ui-file-list",ui_region:".pods-ui-region",form:".pods-ui-form"},field_meta:{},uploader:{},initialize:function(){this.field_meta=this.getOption("field_meta"),this.collection=new t(this.getOption("model_data"),this.field_meta),this.model=new i},onRender:function(){var e=new n({collection:this.collection,field_meta:this.field_meta}),i=new d({field_meta:this.field_meta});this.showChildView("list",e),this.showChildView("form",i),this.uploader=this.createUploader(),this.listenTo(this.uploader,"added:files",this.onAddedFiles)},onChildviewRemoveFileClick:function(e){this.collection.remove(e.model)},onChildviewAddFileClick:function(){this.uploader.invoke()},onAddedFiles:function(e){this.collection.add(e)},createUploader:function(){var e,i=this.field_meta.field_options;return e=w==i.file_uploader?m:b,this.uploader=new e({browse_button:this.getRegion("form").getEl(".pods-file-add").get(),ui_region:this.getRegion("ui_region"),field_options:i}),this.uploader}}),y=jQuery,x={fields:{}};x.Queue=c,jQuery(function(e){e(".pods-form-ui-field").pods_ui_field_init()}),jQuery.fn.pods_ui_field_init=function(){return this.each(function(){var e={},i=void 0,t=void 0,o={field_type:"hidden"};y(this).find("script.data").each(function(){var i=y.parseJSON(y(this).html());y.extend(e,i),y(this).remove()}),e=y.extend(o,e),t=k(e.field_type),void 0!==t&&(i=e.field_meta.field_attributes.id,x.fields[i]=new t({el:this,field_meta:e.field_meta,model_data:e.model_data}),x.fields[i].render())})};var k=function(e){var i=void 0;switch(e){case"file-upload":i=v;break;case"pick":}return i};return x}();
//# sourceMappingURL=pods-ui-ready.min.js.map